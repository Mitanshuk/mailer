<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css">
  <style>
    .feedback-container {
      display: none; /* Hide the feedback initially */
    }
  </style>
  <script>
    function toggleFeedback() {
      var feedbackContainer = document.getElementById("feedback-container");
      feedbackContainer.style.display = feedbackContainer.style.display === "none" ? "block" : "none";
    }
  </script>
</head>

<% if user_signed_in? %>
  <%= link_to "Your Learning", transactions_path, class: 'btn btn-success' %><hr>
  <h1 class="font-weight-bold rounded" style="background:grey; color:white; margin:5px; padding:5px; text-align:center">Upskill Yourself With...</h1><br>

  <div class="row">
    <% @courses.each do |course| %>
      <% unless Transaction.all.where(student_id: current_user.id).pluck(:course_id).include?(course.id) %>
        <div class="col-md-4">
          <div class="card border" style="width: 18rem;">
            <% if course.image.attached? %>
              <%= image_tag course.image, width: '200', height: 'auto', class:"card-img-top" %>
            <% else %>
              <p>No image attached.</p>
            <% end %>
            <div class="card-body">
              <h3 class="card-title"><%= course.title %></h3>
              <p class="card-text"><%= course.description %></p><br>
              <p>at just @<b><%= course.price %></b></p>
              <%= form_with(model: Transaction.new, url: transactions_path, method: :post) do |form| %>
                <%= form.hidden_field :course_id, value: course.id %>
                <%= form.hidden_field :tutor_id, value: course.user_id %>
                <%= form.hidden_field :student_id, value: current_user.id %>
                <%= form.submit "Buy Course" %>
              <% end %>
              <% if course.feedbacks.any? %>
                <h3>Feedbacks:</h3>
                <button onclick="toggleFeedback()">Show Feedback</button>
                <div id="feedback-container" class="feedback-container">
                  <ul>
                    <% course.feedbacks.each do |feedback| %>
                      <li><%= feedback.comment %></li>
                    <% end %>
                  </ul>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
